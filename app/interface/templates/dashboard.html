{% extends "base.html" %}

{% block titulo %}Painel de Contatos{% endblock %}

{% block conteudo %}
<section class="space-y-6">
  <!-- Título e descrição -->
  <header class="flex flex-col gap-2 md:flex-row md:items-end md:justify-between">
    <div>
      <h2 class="text-2xl font-semibold tracking-tight">Visão geral de contatos</h2>
      <p class="text-sm text-slate-400">
        Acompanhe leads, clientes e a evolução da sua base em tempo real.
      </p>
    </div>
    <div class="flex gap-3">
      <a href="/docs#/Contatos" target="_blank"
         class="inline-flex items-center gap-2 text-xs px-3 py-2 rounded-lg border border-slate-700 text-slate-200 hover:border-indigo-500 hover:text-indigo-400 transition-colors">
        Ver API de contatos
      </a>
      <!-- Botão futuro para formulário -->
      <button
        class="inline-flex items-center gap-2 text-xs px-3 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-500 text-white font-medium cursor-not-allowed opacity-60"
        title="Em breve: formulário visual para criar contato">
        + Novo contato (em breve)
      </button>
    </div>
  </header>

  <!-- Cards principais -->
  <section class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
    <article class="rounded-2xl border border-slate-800 bg-gradient-to-br from-slate-900 to-slate-950 p-4">
      <p class="text-xs uppercase tracking-wide text-slate-400 mb-1">Total de contatos</p>
      <p class="text-3xl font-semibold">{{ total_contatos }}</p>
      <p class="text-xs text-slate-500 mt-1">Todos os registros da base.</p>
    </article>

    <article class="rounded-2xl border border-amber-500/40 bg-gradient-to-br from-amber-900/40 to-slate-950 p-4">
      <p class="text-xs uppercase tracking-wide text-amber-300 mb-1">Leads</p>
      <p class="text-3xl font-semibold text-amber-200">{{ total_leads }}</p>
      <p class="text-xs text-amber-200/80 mt-1">Pessoas em fase de prospecção.</p>
    </article>

    <article class="rounded-2xl border border-emerald-500/40 bg-gradient-to-br from-emerald-900/40 to-slate-950 p-4">
      <p class="text-xs uppercase tracking-wide text-emerald-300 mb-1">Clientes</p>
      <p class="text-3xl font-semibold text-emerald-200">{{ total_clientes }}</p>
      <p class="text-xs text-emerald-200/80 mt-1">Contatos com relacionamento ativo.</p>
    </article>

    <article class="rounded-2xl border border-slate-600/50 bg-gradient-to-br from-slate-800 to-slate-950 p-4">
      <p class="text-xs uppercase tracking-wide text-slate-300 mb-1">Inativos</p>
      <p class="text-3xl font-semibold text-slate-100">{{ total_inativos }}</p>
      <p class="text-xs text-slate-400 mt-1">Contatos parados ou perdidos.</p>
    </article>
  </section>

  <!-- NOVOS CARDS AVANÇADOS -->
  <section class="grid grid-cols-1 lg:grid-cols-3 gap-4">
    <!-- Contatos últimos 7 dias -->
    <article class="rounded-2xl border border-sky-500/40 bg-gradient-to-br from-sky-900/40 to-slate-950 p-4 flex flex-col justify-between">
      <div>
        <p class="text-xs uppercase tracking-wide text-sky-300 mb-1">Ritmo de entrada</p>
        <p class="text-3xl font-semibold text-sky-100">{{ contatos_ultimos_7 }}</p>
        <p class="text-xs text-sky-200/80 mt-1">
          Contatos criados nos últimos 7 dias.
        </p>
      </div>
      <p class="text-[11px] text-sky-200/70 mt-3">
        Use esta métrica para acompanhar se a geração de leads está acelerando ou desacelerando.
      </p>
    </article>

    <!-- Taxa de clientes -->
    <article class="rounded-2xl border border-emerald-500/40 bg-gradient-to-br from-emerald-900/40 to-slate-950 p-4 flex flex-col justify-between">
      <div class="flex items-center justify-between gap-2">
        <div>
          <p class="text-xs uppercase tracking-wide text-emerald-300 mb-1">Taxa de clientes na base</p>
          <p class="text-3xl font-semibold text-emerald-100">{{ taxa_clientes }}%</p>
          <p class="text-xs text-emerald-200/80 mt-1">
            Porcentagem de contatos marcados como <span class="font-semibold">cliente</span>.
          </p>
        </div>
      </div>
      <div class="mt-3">
        <div class="h-2 rounded-full bg-slate-900 overflow-hidden">
          <div class="h-2 bg-emerald-500 rounded-full" style="width: {{ taxa_clientes }}%;"></div>
        </div>
        <p class="text-[11px] text-emerald-200/70 mt-2">
          Idealmente, esta barra cresce à medida que seu funil converte mais leads em clientes.
        </p>
      </div>
    </article>

    <!-- Mini funil / Conversão leads -> clientes -->
    <article class="rounded-2xl border border-indigo-500/40 bg-gradient-to-br from-indigo-900/40 to-slate-950 p-4 flex flex-col justify-between">
      <div>
        <p class="text-xs uppercase tracking-wide text-indigo-300 mb-1">Conversão de leads em clientes</p>
        <p class="text-3xl font-semibold text-indigo-100">{{ taxa_conversao_lead_cliente }}%</p>
        <p class="text-xs text-indigo-200/80 mt-1">
          De todos os contatos marcados como <span class="font-semibold">lead</span>, quantos viraram <span class="font-semibold">cliente</span>.
        </p>
      </div>

      <div class="mt-3 space-y-2">
        <div class="flex items-center justify-between text-[11px] text-slate-300">
          <span>Distribuição atual</span>
          <span class="text-slate-400">Base completa (= 100%)</span>
        </div>
        <div class="h-2 rounded-full bg-slate-900 flex overflow-hidden">
          <div class="h-2 bg-amber-400" style="width: {{ taxa_leads }}%;"></div>
          <div class="h-2 bg-emerald-400" style="width: {{ taxa_clientes }}%;"></div>
          <div class="h-2 bg-slate-400" style="width: {{ taxa_inativos }}%;"></div>
          <div class="h-2 bg-slate-600" style="width: {{ taxa_outros }}%;"></div>
        </div>
        <div class="flex flex-wrap gap-2 mt-1 text-[11px] text-slate-300">
          <span class="inline-flex items-center gap-1">
            <span class="w-3 h-1.5 rounded-full bg-amber-400"></span> Leads ({{ taxa_leads }}%)
          </span>
          <span class="inline-flex items-center gap-1">
            <span class="w-3 h-1.5 rounded-full bg-emerald-400"></span> Clientes ({{ taxa_clientes }}%)
          </span>
          <span class="inline-flex items-center gap-1">
            <span class="w-3 h-1.5 rounded-full bg-slate-400"></span> Inativos ({{ taxa_inativos }}%)
          </span>
          <span class="inline-flex items-center gap-1">
            <span class="w-3 h-1.5 rounded-full bg-slate-600"></span> Outros ({{ taxa_outros }}%)
          </span>
        </div>
      </div>
    </article>
  </section>

  <!-- Tabela de contatos -->
  <section class="rounded-2xl border border-slate-800 bg-slate-950/60 overflow-hidden">
    <header class="px-4 py-3 border-b border-slate-800 flex items-center justify-between">
      <div>
        <h3 class="text-sm font-semibold">Contatos recentes</h3>
        <p class="text-xs text-slate-400">
          Ordenado pelos mais novos primeiro.
        </p>
      </div>
    </header>

    <div class="overflow-x-auto">
      <table class="min-w-full text-sm">
        <thead class="bg-slate-900 border-b border-slate-800">
          <tr>
            <th class="text-left px-4 py-2 font-medium text-slate-300">Nome</th>
            <th class="text-left px-4 py-2 font-medium text-slate-300">E-mail</th>
            <th class="text-left px-4 py-2 font-medium text-slate-300">Telefone</th>
            <th class="text-left px-4 py-2 font-medium text-slate-300">Situação</th>
            <th class="text-left px-4 py-2 font-medium text-slate-300">Criado em</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-800">
          {% if contatos %}
            {% for contato in contatos %}
              <tr class="hover:bg-slate-900/60 transition-colors">
                <td class="px-4 py-2">
                  <div class="font-medium">
                    {{ contato.primeiro_nome }}{% if contato.sobrenome %} {{ contato.sobrenome }}{% endif %}
                  </div>
                </td>
                <td class="px-4 py-2 text-slate-300">
                  {{ contato.email or "-" }}
                </td>
                <td class="px-4 py-2 text-slate-300">
                  {{ contato.telefone or "-" }}
                </td>
                <td class="px-4 py-2">
                  {% if contato.situacao == "lead" %}
                    <span class="inline-flex items-center rounded-full bg-amber-500/15 text-amber-300 px-3 py-0.5 text-xs">
                      Lead
                    </span>
                  {% elif contato.situacao == "cliente" %}
                    <span class="inline-flex items-center rounded-full bg-emerald-500/15 text-emerald-300 px-3 py-0.5 text-xs">
                      Cliente
                    </span>
                  {% elif contato.situacao == "inativo" %}
                    <span class="inline-flex items-center rounded-full bg-slate-500/15 text-slate-300 px-3 py-0.5 text-xs">
                      Inativo
                    </span>
                  {% else %}
                    <span class="inline-flex items-center rounded-full bg-slate-500/10 text-slate-200 px-3 py-0.5 text-xs">
                      {{ contato.situacao }}
                    </span>
                  {% endif %}
                </td>
                <td class="px-4 py-2 text-xs text-slate-400">
                  {% if contato.criado_em %}
                    {{ contato.criado_em.strftime('%d/%m/%Y %H:%M') }}
                  {% else %}
                    -
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="5" class="px-4 py-6 text-center text-slate-500 text-sm">
                Ainda não há contatos cadastrados.
                <span class="block text-xs text-slate-500 mt-1">
                  Use a rota <code class="font-mono text-indigo-300">POST /api/v1/contatos</code> na documentação para criar o primeiro.
                </span>
              </td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </section>
</section>
{% endblock %}
